---
title: "Premier League Predictions"
author: "@awhstin"
date: 2017-07-20T21:13:14-05:00
titleimg: "pred-1"
imgtype: "png"
---

This is a page dedicated to weekly predictions for English Premier League. I am a fan of the Premier League and I support the Southampton Saints though try as I might no sort of projection I do can make them better. A lot of the data for this comes from the awesome <code>engsoccerdata</code> package available on [github](https://github.com/jalapic/engsoccerdata). My predictions are under constantly construction, but they are based on Poisson distributions, and you can read a little bit about those [here](https://www.pinnacle.com/en/betting-articles/Soccer/how-to-calculate-poisson-distribution/MD62MLXUMKMXZ6A8#height). Though this will appear on my blog feed it can be found in later weeks on the navigation bar via the <i class="fa fa-signal"></i> button.
```{r, include=FALSE}
library(tidyverse)
library(rvest)
library(fuzzyjoin)
library(formattable)
#fixtures
fixtures <- read_csv("~/Desktop/blog/rprojs/fixtures.csv")
#grab stats for poisson
england<-read_csv('https://raw.githubusercontent.com/jalapic/engsoccerdata/master/data-raw/england.csv')
new.teams<-c('Huddersfield Town','Newcastle United','Brighton & Hove Albion')
england<-subset(england,Season==2016 & division == 1 | division==2 & Season==2016 & (home %in% new.teams | visitor %in% new.teams))
total.hgoals<-aggregate(england$hgoal,by=list(england$home),sum)
total.agoals<-aggregate(england$vgoal,by=list(england$visitor),sum)
total.conceded<-aggregate(england$hgoal,by=list(england$visitor),sum)
england$hwin<-ifelse(england$result=='H',1,0)
england$awin<-ifelse(england$result=='A',1,0)
england$dwin<-ifelse(england$result=='D',1,0)
total.awins<-aggregate(england$awin,by=list(england$visitor),sum)
total.hwins<-aggregate(england$hwin,by=list(england$visitor),sum)
total.dwins<-aggregate(england$dwin,by=list(england$visitor),sum)
homegames<-aggregate(england$home,by=list(england$home),length)
awaygames<-aggregate(england$visitor,by=list(england$visitor),length)
games<-aggregate(england$Date,by=list(england$division),length)
summary<-cbind(total.hgoals,total.away=total.agoals$x,conceded=total.conceded$x,home.wins=total.hwins$x,away.wins=total.awins$x,draws=total.dwins$x,awaygames=awaygames$x,homegames=homegames$x)

#division 1 goals divided by # of division 1 games
div1<-subset(england,division==1)
seasonhgoals<-sum(div1$hgoal)
seasonagoals<-sum(div1$vgoal)

#calculations
summary$attack<-(summary$x/summary$homegames)/(seasonhgoals/365)
summary$defense<-(summary$conceded/summary$awaygames)/(seasonagoals/365)
summary$aattack<-(summary$total.away/summary$awaygames)/(seasonagoals/365)

summary$attack[which(summary$Group.1 %in% new.teams)]<-summary$attack[which(summary$Group.1 %in% new.teams)]*.25
summary$aattack[which(summary$Group.1 %in% new.teams)]<-summary$aattack[which(summary$Group.1 %in% new.teams)]*.25
summary$defense[which(summary$Group.1 %in% new.teams)]<-summary$defense[which(summary$Group.1 %in% new.teams)]*1.25

team.stats<-summary[c(1,10,11,12)]
fixture.stats<-left_join(fixtures,team.stats,by=c('home'='Group.1'))
fixture.stats<-left_join(fixture.stats,team.stats,by=c('visitor'='Group.1'))

#goals
fixture.stats$home.goals<-round(fixture.stats$attack.x*fixture.stats$defense.y*(seasonhgoals/365))
fixture.stats$away.goals<-round(fixture.stats$aattack.y*fixture.stats$defense.y*(seasonagoals/365))

fixture.stats<-fixture.stats[c(2,3,4,11,12)]
names(fixture.stats)[1:5]<-c('Date','Home','Visitor','Home Goals','Away Goals')



thisweek<-head(fixture.stats,10)
thisweek$`Home Goals`[which(thisweek$`Home Goals`>=3)]<-3
thisweek$`Away Goals`[which(thisweek$`Away Goals`>=3)]<-3
thisweek$Result<-NA

#------------------------------------------------table
#order
rownames(thisweek) <- c() #just for formattable
#bold
bold <- formatter("span", 
                  style = x ~ style("font-weight" = 'bold'))
```

<hr>
<center>
###Week 1

```{r pred, echo=FALSE, fig.path='../', message=FALSE, warning=FALSE, dev='png'}
formattable(thisweek,list(
  Date=bold,
  area(col = 4:5) ~ color_tile("transparent", "#90ee90"),
  Result=color_tile(max.color='#dedede',min.color='#dedede'),style(width='150')
))
```
</center>